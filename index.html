<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Squid AI - Enhanced Settings</title>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6188470185582355"
     crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Updated Firebase SDK v9 -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <style>
        :root {
            --bg-dark: #0c0c14;
            --primary: #9d4dff;
            --secondary: #1a1a25;
            --text-light: #f0f0ff;
            --accent: #00e0d0;
            --border-radius: 20px;
            --card-bg: rgba(30, 30, 46, 0.6);
            --input-bg: rgba(40, 40, 56, 0.4);
            --hover-light: rgba(255,255,255,0.15);
            --glass-bg: rgba(22, 22, 40, 0.4);
            --glass-border: rgba(255, 255, 255, 0.1);
            --glow: 0 0 20px rgba(157, 77, 255, 0.3);
        }
        
        body.light-mode {
            --bg-dark: #f5f7ff;
            --primary: #9147ff;
            --secondary: #e4e6fa;
            --text-light: #05051a;
            --accent: #00b5ad;
            --card-bg: rgba(255, 255, 255, 0.8);
            --input-bg: rgba(230, 230, 250, 0.6);
            --hover-light: rgba(0,0,0,0.05);
            --glass-bg: rgba(255, 255, 255, 0.7);
            --glass-border: rgba(0, 0, 0, 0.05);
            --glow: 0 0 20px rgba(145, 71, 255, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--bg-dark) 0%, #1a1a2e 100%);
            color: var(--text-light);
            height: 100vh;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.3s, color 0.3s;
        }
        
        body::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 10% 20%, rgba(157, 77, 255, 0.15) 0%, transparent 40%),
                        radial-gradient(circle at 90% 80%, rgba(0, 224, 208, 0.15) 0%, transparent 40%);
            pointer-events: none;
            z-index: -1;
        }

        /* Loader */
        .loader-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            z-index: 10;
        }
        .loader {
            border: 4px solid var(--secondary);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1.2s cubic-bezier(0.5, 0, 0.5, 1) infinite;
            position: relative;
        }
        .loader::after {
            content: '';
            position: absolute;
            top: -6px;
            left: -6px;
            right: -6px;
            bottom: -6px;
            border: 4px solid transparent;
            border-top: 4px solid var(--accent);
            border-radius: 50%;
            animation: spin 1.5s cubic-bezier(0.5, 0, 0.5, 1) infinite;
            animation-delay: 0.3s;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Login Container */
        .login-container {
            display: none;
            width: 100%;
            max-width: 440px;
            padding: 40px;
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            border-radius: var(--border-radius);
            border: 1px solid var(--glass-border);
            box-shadow: 0 15px 35px rgba(0,0,0,0.2), var(--glow);
            text-align: center;
            transition: transform 0.4s ease, opacity 0.4s ease;
            position: relative;
            overflow: hidden;
            z-index: 2;
        }
        
        .login-container::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(157, 77, 255, 0.1) 0%, transparent 70%);
            z-index: -1;
        }

        .login-logo {
            font-size: 90px;
            margin-bottom: 30px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 5px 15px rgba(157, 77, 255, 0.3));
        }
        
        .login-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .input-group {
            position: relative;
        }

        .input-group i {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary);
            font-size: 18px;
            z-index: 2;
        }

        .login-input {
            width: 100%;
            padding: 18px 18px 18px 55px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 50px;
            background: var(--input-bg);
            color: var(--text-light);
            font-size: 16px;
            outline: none;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
            position: relative;
            z-index: 1;
        }

        .login-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(157, 77, 255, 0.3);
        }

        .login-button {
            padding: 18px;
            background: linear-gradient(135deg, var(--primary), #7a2fff);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
            box-shadow: 0 5px 15px rgba(157, 77, 255, 0.3);
            position: relative;
            overflow: hidden;
            z-index: 1;
        }
        
        .login-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #7a2fff, var(--primary));
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .login-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(157, 77, 255, 0.5);
        }
        
        .login-button:hover::before {
            opacity: 1;
        }

        .form-footer {
            margin-top: 20px;
            font-size: 14px;
            color: #aaa;
        }

        .form-footer a {
            color: var(--accent);
            text-decoration: none;
            font-weight: 600;
            transition: all 0.2s ease;
        }
        
        .form-footer a:hover {
            text-decoration: underline;
            color: var(--primary);
        }

        .error-message {
            color: #ff6b6b;
            font-size: 14px;
            margin-top: 5px;
            text-align: left;
            padding-left: 20px;
            display: none;
            min-height: 20px;
        }
        #generalError {
            text-align: center;
            margin-top: -10px;
            margin-bottom: 10px;
            padding: 0;
        }

        /* App Container */
        .app-container {
            width: 100%;
            height: 100%;
            max-width: 500px;
            max-height: 900px;
            display: none;
            flex-direction: column;
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            box-shadow: 0 0 40px rgba(0,0,0,0.3), var(--glow);
            position: relative;
            overflow: hidden;
            border-radius: 30px;
            border: 1px solid var(--glass-border);
            transition: all 0.3s ease;
            z-index: 2;
        }
        
        /* Header */
        .app-header {
            padding: 20px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            z-index: 10;
            border-bottom: 1px solid var(--glass-border);
            transition: all 0.3s;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .app-logo {
            font-size: 34px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 3px 8px rgba(157, 77, 255, 0.2));
        }

        .app-title {
            font-weight: 700;
            font-size: 20px;
            letter-spacing: 0.5px;
        }

        .header-icon {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: var(--input-bg);
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid var(--glass-border);
            color: var(--text-light);
            font-size: 18px;
            backdrop-filter: blur(5px);
        }
        
        .header-icon:hover {
            transform: scale(1.08);
            background: rgba(157, 77, 255, 0.2);
            box-shadow: 0 0 15px rgba(157, 77, 255, 0.2);
        }
        
        /* Content Wrapper for scrolling fix */
        .content-wrapper {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        /* Main Content & Containers */
        .main-content, .chat-container, .settings-container, .game-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow-y: auto;
            background: transparent;
            padding: 25px;
            animation: fadeIn 0.4s ease;
        }

        .main-content {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .welcome-text {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 40px;
            text-align: center;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 3px 8px rgba(157, 77, 255, 0.2));
        }

        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 20px;
            width: 100%;
            max-width: 400px;
            margin-bottom: 30px;
        }

        .action-button {
            padding: 22px;
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius);
            color: var(--text-light);
            font-size: 17px;
            font-weight: 600;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: left;
            backdrop-filter: blur(5px);
            position: relative;
            overflow: hidden;
        }
        
        .action-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(157, 77, 255, 0.1), rgba(0, 224, 208, 0.1));
            z-index: 0;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .action-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            border-color: rgba(157, 77, 255, 0.3);
        }
        
        .action-button:hover::before {
            opacity: 1;
        }
        
        body.light-mode .action-button:hover {
            background: rgba(255, 255, 255, 0.9);
        }

        .action-button .icon {
            margin-right: 15px;
            font-size: 26px;
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 1;
        }

        /* Chat Container */
        .chat-container {
            display: none;
            flex-direction: column;
            padding: 0;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .message {
            max-width: 85%;
            padding: 18px;
            border-radius: 22px;
            word-wrap: break-word;
            animation: fadeInUp 0.4s ease;
            position: relative;
            line-height: 1.5;
            transition: background-color 0.3s, color 0.3s;
            backdrop-filter: blur(5px);
        }
        
        .message::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            bottom: 0;
        }

        .user-message {
            align-self: flex-end;
            background: linear-gradient(135deg, var(--primary), #7a2fff);
            color: white;
            border-bottom-right-radius: 5px;
            box-shadow: 0 5px 15px rgba(157, 77, 255, 0.2);
            animation-name: fadeInRight;
        }
        
        .user-message::after {
            right: -10px;
            background: linear-gradient(135deg, var(--primary), #7a2fff);
            clip-path: polygon(0 0, 100% 100%, 100% 0);
            transform: rotate(-45deg);
            bottom: 10px;
        }

        .ai-message {
            align-self: flex-start;
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            border-bottom-left-radius: 5px;
            animation-name: fadeInLeft;
        }
        
        .ai-message::after {
            left: -10px;
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            clip-path: polygon(0 0, 0 100%, 100% 0);
            transform: rotate(45deg);
            bottom: 10px;
        }

        .message-time { 
            font-size: 11px; 
            opacity: 0.8; 
            margin-top: 8px; 
            text-align: right; 
            font-weight: 300;
        }
        
        /* MERGED: Style for images in messages */
        .message-image {
            max-width: 100%;
            border-radius: 15px;
            margin-bottom: 10px;
            display: block;
        }

        .typing-indicator {
            display: flex; 
            align-items: center; 
            padding: 18px; 
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            border-radius: 22px; 
            border-bottom-left-radius: 5px; 
            align-self: flex-start;
            margin-bottom: 15px; 
            width: 110px; 
            backdrop-filter: blur(5px);
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 0.8; }
            50% { opacity: 1; }
            100% { opacity: 0.8; }
        }
        
        .typing-dot {
            width: 9px; 
            height: 9px; 
            background-color: var(--primary); 
            border-radius: 50%;
            margin: 0 5px; 
            animation: typingAnimation 1.4s infinite ease-in-out;
        }
        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        /* Chat Input */
        .chat-input-container {
            padding: 15px 20px; 
            display: flex; 
            align-items: center;
            gap: 10px;
            background: var(--glass-bg); 
            border-top: 1px solid var(--glass-border);
            backdrop-filter: blur(10px);
            flex-wrap: wrap;
        }

        .chat-input {
            flex: 1; 
            min-width: 50px;
            padding: 15px 20px; 
            border: 1px solid var(--glass-border); 
            border-radius: 50px;
            background: var(--input-bg); 
            color: var(--text-light); 
            font-size: 16px;
            outline: none; 
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }
        
        .chat-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(157, 77, 255, 0.2);
        }

        .send-button {
            width: 50px; 
            height: 50px; 
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), #7a2fff); 
            border: none;
            color: white; 
            display: flex; 
            justify-content: center; 
            align-items: center;
            cursor: pointer; 
            transition: all 0.3s ease; 
            font-size: 18px; 
            box-shadow: 0 5px 15px rgba(157, 77, 255, 0.3);
            flex-shrink: 0;
        }
        
        .send-button:hover {
            transform: scale(1.08) rotate(10deg);
            box-shadow: 0 7px 20px rgba(157, 77, 255, 0.4);
        }
        
        /* MERGED: Attachment button styles */
        .attachment-button {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--input-bg);
            border: 1px solid var(--glass-border);
            color: var(--primary);
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 18px;
            flex-shrink: 0;
        }
        
        .attachment-button:hover {
            background: rgba(157, 77, 255, 0.2);
            transform: scale(1.05);
        }

        /* MERGED: Image Preview styles */
        #hindiImagePreviewContainer {
            padding: 0 20px 10px 20px;
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: flex-start;
        }
        .image-preview {
            position: relative;
            display: inline-block;
            background: var(--input-bg);
            padding: 8px;
            border-radius: 12px;
        }
        .image-preview img {
            max-width: 80px;
            max-height: 80px;
            border-radius: 8px;
            display: block;
        }
        .remove-preview-btn {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 22px;
            height: 22px;
            background: #ff4d4d;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            transition: transform 0.2s;
        }
        .remove-preview-btn:hover {
            transform: scale(1.1);
        }

        /* Bottom Navigation */
        .bottom-nav {
            display: flex; 
            justify-content: space-around; 
            padding: 15px 0;
            background: var(--glass-bg); 
            border-top: 1px solid var(--glass-border);
            backdrop-filter: blur(10px);
        }

        .nav-item {
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            color: #aaa;
            cursor: pointer; 
            transition: all 0.3s ease; 
            padding: 8px 25px; 
            border-radius: 50px;
            position: relative;
        }
        
        .nav-item::after {
            content: '';
            position: absolute;
            bottom: 0;
            width: 0;
            height: 3px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 3px;
            transition: width 0.3s ease;
        }
        
        .nav-item.active { 
            color: var(--primary); 
        }
        
        .nav-item.active::after {
            width: 30px;
        }
        
        .nav-item:hover { 
            color: var(--primary);
            background: rgba(157, 77, 255, 0.1);
        }
        
        .nav-icon { 
            font-size: 22px; 
            margin-bottom: 5px; 
            transition: all 0.3s ease;
        }
        
        .nav-item:hover .nav-icon {
            transform: translateY(-3px);
        }
        
        .nav-label { 
            font-size: 13px; 
            font-weight: 500;
        }
        
        /* Settings Container */
        .settings-container {
            display: none;
            flex-direction: column;
            gap: 25px;
            padding: 25px;
        }
        
        .settings-header {
            font-size: 24px;
            font-weight: 700;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--glass-border);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .settings-header i {
            color: var(--primary);
        }
        
        .settings-item {
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            background: var(--card-bg); 
            padding: 20px; 
            border-radius: var(--border-radius);
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(5px);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .settings-item:hover {
            transform: translateX(5px);
            background: rgba(157, 77, 255, 0.1);
        }
        
        .settings-item label { 
            font-size: 17px; 
            font-weight: 500; 
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
        }
        
        .settings-item i {
            color: var(--primary);
            font-size: 20px;
        }
        
        .logout-button {
            width: 100%; 
            padding: 18px; 
            background: linear-gradient(135deg, #ff4d4d, #ff2d2d);
            color: white; 
            border: none;
            border-radius: var(--border-radius); 
            font-size: 17px; 
            font-weight: 600; 
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(255, 77, 77, 0.2);
            margin-top: 10px;
        }
        
        .logout-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 77, 77, 0.3);
        }

        /* Theme Toggle Switch */
        .theme-switch { 
            position: relative; 
            display: inline-block; 
            width: 55px; 
            height: 30px; 
        }
        
        .theme-switch input { 
            opacity: 0; 
            width: 0; 
            height: 0; 
        }
        
        .slider { 
            position: absolute; 
            cursor: pointer; 
            top: 0; 
            left: 0; 
            right: 0; 
            bottom: 0; 
            background: var(--input-bg); 
            transition: .4s; 
            border-radius: 34px; 
            border: 1px solid var(--glass-border);
        }
        
        .slider:before { 
            position: absolute; 
            content: ""; 
            height: 24px; 
            width: 24px; 
            left: 3px; 
            bottom: 2.5px; 
            background: linear-gradient(135deg, var(--primary), var(--accent));
            transition: .4s; 
            border-radius: 50%; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        input:checked + .slider { 
            background: var(--primary);
        }
        
        input:checked + .slider:before { 
            transform: translateX(25px); 
            background: white;
        }

        /* Chat History */
        #chatHistoryList {
            list-style: none;
            padding: 0;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .history-item {
            background: var(--card-bg);
            padding: 18px;
            border-radius: 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(5px);
            position: relative;
        }
        
        .history-item:hover { 
            transform: translateY(-3px);
            background: rgba(157, 77, 255, 0.1);
            border-color: rgba(157, 77, 255, 0.3);
        }
        
        .history-title {
            white-space: nowrap; 
            overflow: hidden; 
            text-overflow: ellipsis; 
            max-width: 70%;
            font-weight: 500;
        }

        .lang-badge {
            background-color: var(--primary);
            color: white;
            padding: 3px 8px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            margin-right: 10px;
        }
        
        .history-actions button {
            background: none; 
            border: none; 
            color: #aaa; 
            cursor: pointer; 
            font-size: 18px; 
            margin-left: 12px;
            transition: all 0.2s ease;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .history-actions button:hover { 
            color: var(--primary);
            background: rgba(157, 77, 255, 0.1);
        }
        
        #noHistoryMessage { 
            text-align: center; 
            color: #aaa; 
            margin-top: 30px; 
            font-style: italic;
        }
        
        /* IQ Game Container */
        .game-container {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
        }
        
        .game-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 20px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 3px 8px rgba(157, 77, 255, 0.2));
        }
        
        .round-title {
            font-size: 18px;
            margin-bottom: 15px;
        }
        
        .timer-display {
            font-size: 18px;
            margin: 10px 0 20px;
            background: var(--card-bg);
            padding: 10px 20px;
            border-radius: 50px;
            display: inline-block;
            border: 1px solid var(--glass-border);
        }
        
        .emoji-container {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 20px 0;
        }
        
        .emoji {
            font-size: 2.5rem;
            cursor: pointer;
            transition: transform 0.2s;
            background: var(--card-bg);
            padding: 15px;
            border-radius: 15px;
            border: 1px solid var(--glass-border);
        }
        
        .emoji:hover {
            transform: scale(1.1);
            background: rgba(157, 77, 255, 0.2);
        }
        
        .game-button {
            padding: 12px 24px;
            font-size: 16px;
            background: linear-gradient(135deg, var(--primary), #7a2fff);
            border: none;
            color: white;
            border-radius: 50px;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(157, 77, 255, 0.3);
        }
        
        .game-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(157, 77, 255, 0.5);
        }
        
        .iq-result {
            font-size: 24px;
            margin-top: 20px;
            font-weight: bold;
            background: linear-gradient(135deg, var(--accent), #00c6ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        /* New Settings Pages */
        .info-container {
            display: none;
            flex-direction: column;
            gap: 25px;
            padding: 25px;
            height: 100%;
            overflow-y: auto;
        }
        
        .info-header {
            display: flex;
            align-items: center;
            gap: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--glass-border);
        }
        
        .info-header h2 {
            font-size: 24px;
            font-weight: 700;
        }
        
        .info-header i {
            color: var(--primary);
            font-size: 28px;
        }
        
        .info-content {
            background: var(--card-bg);
            padding: 25px;
            border-radius: var(--border-radius);
            border: 1px solid var(--glass-border);
            line-height: 1.7;
            backdrop-filter: blur(5px);
        }
        
        .info-content h3 {
            color: var(--primary);
            margin: 20px 0 10px;
            font-size: 20px;
        }
        
        .info-content ul {
            padding-left: 25px;
            margin: 10px 0;
        }
        
        .info-content li {
            margin-bottom: 8px;
        }
        
        .back-button {
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--input-bg);
            border: 1px solid var(--glass-border);
            color: var(--text-light);
            padding: 12px 20px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
            backdrop-filter: blur(5px);
            width: fit-content;
        }
        
        .back-button:hover {
            background: rgba(157, 77, 255, 0.1);
            transform: translateX(-5px);
        }
        
        .highlight-box {
            background: rgba(157, 77, 255, 0.1);
            border-left: 3px solid var(--primary);
            padding: 15px;
            border-radius: 0 10px 10px 0;
            margin: 15px 0;
        }
        
        /* Animations */
        @keyframes typingAnimation { 
            0%, 60%, 100% { transform: translateY(0); } 
            30% { transform: translateY(-6px); } 
        }
        
        @keyframes fadeIn { 
            from { opacity: 0; transform: translateY(20px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes fadeInLeft {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        @keyframes fadeInRight {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        /* Floating animation for logo */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        .app-logo, .login-logo {
            animation: float 4s ease-in-out infinite;
        }

        /* Responsive */
        @media (max-width: 500px) {
            .app-container { 
                max-width: 100%; 
                max-height: 100%; 
                border-radius: 0; 
            }
            
            .login-container { 
                width: 90%; 
                padding: 30px;
            }
            
            .app-header {
                padding: 15px 20px;
            }
            
            .action-button {
                padding: 18px;
            }
            
            .chat-messages {
                padding: 15px;
            }
            
            .emoji {
                font-size: 2rem;
                padding: 12px;
            }
            
            /* Hindi chat input adjustments */
            .chat-input-container {
                padding: 10px 15px;
                gap: 8px;
            }
            
            .chat-input {
                padding: 12px 15px;
                font-size: 14px;
            }
            
            .attachment-button, .send-button {
                width: 45px;
                height: 45px;
                font-size: 16px;
            }
        }
        
        @media (max-width: 380px) {
            .chat-input {
                font-size: 13px;
                padding: 10px 15px;
            }
        }
    </style>
</head>
<body>

    <div class="loader-container" id="loaderContainer">
        <div class="loader"></div>
        <p>Initializing Squid AI...</p>
    </div>

    <div class="login-container" id="loginContainer">
        <div class="login-logo">🦑</div>
        <div class="login-form">
            <div class="input-group">
                <i class="fas fa-envelope"></i>
                <input type="email" class="login-input" id="emailInput" placeholder="Email address" autocomplete="email">
            </div>
            <div class="error-message" id="emailError">Please enter a valid email</div>
            <div class="input-group">
                <i class="fas fa-lock"></i>
                <input type="password" class="login-input" id="passwordInput" placeholder="Password" autocomplete="current-password">
            </div>
            <div class="error-message" id="passwordError">Password must be at least 6 characters</div>
            <div class="error-message" id="generalError"></div>
            <button class="login-button" id="authButton">Log In</button>
            <div class="form-footer">
                <span id="formFooterText">Don't have an account?</span> <a href="#" id="toggleAuthModeLink">Sign Up</a>
            </div>
        </div>
    </div>

    <div class="app-container" id="appContainer">
        <div class="app-header">
            <div class="logo-container">
                <div class="app-logo">🦑</div>
                <div class="app-title" id="appTitle">Squid AI</div>
            </div>
            <button class="header-icon" id="settingsButton" title="Settings">
                <i class="fas fa-cog"></i>
            </button>
        </div>

        <div class="content-wrapper">
            <!-- Main Content -->
            <div class="main-content" id="mainContent">
                <div class="welcome-text">Where should we start?</div>
                <div class="action-buttons">
                    <button class="action-button" id="chatButton"><span class="icon">💬</span> Start a new chat</button>
                    <button class="action-button" id="hindiChatButton"><span class="icon">🇮🇳</span> Chat in Hindi</button>
                    <button class="action-button" id="iqButton"><span class="icon">🧠</span> IQ Calculator</button>
                    <button class="action-button" id="learnButton"><span class="icon">📚</span> Learn about AI</button>
                    <button class="action-button" id="codeButton"><span class="icon"><i class="fas fa-code"></i></span> Create Codes</button>
                </div>
            </div>

            <!-- Chat Container (English) -->
            <div class="chat-container" id="chatContainer">
                <div class="chat-messages" id="chatMessages"></div>
                <div class="chat-input-container">
                    <input type="text" class="chat-input" id="chatInput" placeholder="Ask Squid AI...">
                    <button class="send-button" id="sendButton"><i class="fas fa-paper-plane"></i></button>
                </div>
            </div>

            <!-- Hindi Chat Container -->
            <div class="chat-container" id="hindiChatContainer">
                <div class="chat-messages" id="hindiChatMessages"></div>
                <!-- Image Preview Container -->
                <div id="hindiImagePreviewContainer"></div>
                <div class="chat-input-container">
                    <!-- Attachment Button -->
                    <button class="attachment-button" id="hindiAttachmentButton" title="Attach image">
                        <i class="fas fa-paperclip"></i>
                    </button>
                    <!-- Hidden File Input -->
                    <input type="file" id="hindiFileInput" accept="image/jpeg, image/png, image/webp" style="display: none;">
                    <input type="text" class="chat-input" id="hindiChatInput" placeholder="छवि के साथ कुछ पूछें...">
                    <button class="send-button" id="hindiSendButton"><i class="fas fa-paper-plane"></i></button>
                </div>
            </div>
            
            <!-- Settings Container -->
            <div class="settings-container" id="settingsContainer">
                <h2 class="settings-header"><i class="fas fa-cog"></i> Settings</h2>
                
                <div class="settings-item" id="howToUseBtn">
                    <label><i class="fas fa-book"></i> How to Use</label>
                    <i class="fas fa-chevron-right"></i>
                </div>
                
                <div class="settings-item" id="privacyPolicyBtn">
                    <label><i class="fas fa-shield-alt"></i> Privacy Policy</label>
                    <i class="fas fa-chevron-right"></i>
                </div>
                
                <div class="settings-item" id="securityBtn">
                    <label><i class="fas fa-lock"></i> Security</label>
                    <i class="fas fa-chevron-right"></i>
                </div>
                
                <div class="settings-item">
                    <label for="themeToggle"><i class="fas fa-sun"></i> Light Mode</label>
                    <label class="theme-switch">
                        <input type="checkbox" id="themeToggle">
                        <span class="slider"></span>
                    </label>
                </div>
                
                <div>
                    <h3 class="settings-header" style="margin-top: 20px; font-size: 20px;"><i class="fas fa-history"></i> Chat History</h3>
                     <ul id="chatHistoryList"></ul>
                     <p id="noHistoryMessage" style="display: none;">No saved chats yet.</p>
                </div>
                
                <div class="settings-item" style="background: none; padding: 0; margin-top: auto;">
                    <button class="logout-button" id="logoutButton">Log Out</button>
                </div>
            </div>
            
            <!-- How to Use Container -->
            <div class="info-container" id="howToUseContainer">
                <div class="info-header">
                    <i class="fas fa-book"></i>
                    <h2>How to Use Squid AI</h2>
                </div>
                
                <div class="info-content">
                    <p>Welcome to Squid AI! Here's how to make the most of your experience:</p>
                    
                    <h3>Getting Started</h3>
                    <ul>
                        <li><strong>New Chat</strong>: Tap the "New Chat" button to start a conversation</li>
                        <li><strong>Hindi Chat</strong>: Select "Chat in Hindi" for conversations in Hindi</li>
                        <li><strong>IQ Test</strong>: Try our fun IQ calculator game under "IQ Calculator"</li>
                    </ul>
                    
                    <h3>Chat Features</h3>
                    <ul>
                        <li>Type your message and press Enter or tap the send button</li>
                        <li>View your chat history in the Settings menu</li>
                        <li>Switch between English and Hindi chats anytime</li>
                        <li>In Hindi chat, tap the paperclip icon <i class="fas fa-paperclip"></i> to analyze photos</li>
                    </ul>
                    
                    <div class="highlight-box">
                        <p><i class="fas fa-lightbulb"></i> <strong>Pro Tip</strong>: Use specific questions to get the most accurate answers from Squid AI. For example: "Explain quantum computing in simple terms" or "Write a Python function to calculate factorial".</p>
                    </div>
                    
                    <h3>Daily Limits</h3>
                    <p>To ensure fair usage for everyone:</p>
                    <ul>
                        <li>Hindi chats are limited to 100 messages per day</li>
                        <li>English chats have no daily limits</li>
                        <li>IQ game can be played unlimited times</li>
                    </ul>
                    
                    <button class="back-button" id="backFromHowToUse">
                        <i class="fas fa-arrow-left"></i> Back to Settings
                    </button>
                </div>
            </div>
            
            <!-- Privacy Policy Container -->
            <div class="info-container" id="privacyPolicyContainer">
                <div class="info-header">
                    <i class="fas fa-shield-alt"></i>
                    <h2>Privacy Policy</h2>
                </div>
                
                <div class="info-content">
                    <p>Your privacy is important to us. This policy explains how we handle your information:</p>
                    
                    <h3>Data Collection</h3>
                    <p>We collect the following information:</p>
                    <ul>
                        <li>Email address for authentication purposes</li>
                        <li>Chat history stored locally on your device</li>
                        <li>Usage statistics (without personal identifiers)</li>
                    </ul>
                    
                    <h3>Data Usage</h3>
                    <p>Your data is used to:</p>
                    <ul>
                        <li>Provide and improve our services</li>
                        <li>Personalize your experience</li>
                        <li>Maintain security and prevent abuse</li>
                    </ul>
                    
                    <div class="highlight-box">
                        <p><i class="fas fa-exclamation-triangle"></i> <strong>Important</strong>: We never sell your personal data to third parties. Your chat history remains on your device unless you choose to share it.</p>
                    </div>
                    
                    <h3>Data Storage</h3>
                    <p>All your data is stored securely:</p>
                    <ul>
                        <li>Authentication handled by Firebase</li>
                        <li>Chat history stored in your browser's local storage</li>
                        <li>No personal data stored on our servers</li>
                        <li>Uploaded images are processed temporarily and never stored</li>
                    </ul>
                    
                    <h3>Changes to This Policy</h3>
                    <p>We may update this policy occasionally. Continued use of Squid AI constitutes acceptance of these changes.</p>
                    
                    <button class="back-button" id="backFromPrivacyPolicy">
                        <i class="fas fa-arrow-left"></i> Back to Settings
                    </button>
                </div>
            </div>
            
            <!-- Security Container -->
            <div class="info-container" id="securityContainer">
                <div class="info-header">
                    <i class="fas fa-lock"></i>
                    <h2>Security Information</h2>
                </div>
                
                <div class="info-content">
                    <p>Squid AI is built with security as a top priority. Here's how we protect you:</p>
                    
                    <h3>Data Protection</h3>
                    <ul>
                        <li>End-to-end encryption for all communications</li>
                        <li>Secure authentication via Firebase</li>
                        <li>Regular security audits of our codebase</li>
                    </ul>
                    
                    <h3>Your Responsibilities</h3>
                    <p>To maintain your security:</p>
                    <ul>
                        <li>Use a strong, unique password</li>
                        <li>Never share your login credentials</li>
                        <li>Log out when using shared devices</li>
                        <li>Keep your device software updated</li>
                    </ul>
                    
                    <div class="highlight-box">
                        <p><i class="fas fa-shield-alt"></i> <strong>Security Tip</strong>: Squid AI will never ask for your password outside of the login screen. Be wary of any messages requesting personal information.</p>
                    </div>
                    
                    <h3>API Security</h3>
                    <p>Our AI integrations are secured through:</p>
                    <ul>
                        <li>API key encryption and rotation</li>
                        <li>Strict rate limiting to prevent abuse</li>
                        <li>Regular monitoring of API usage patterns</li>
                    </ul>
                    
                    <h3>Reporting Security Issues</h3>
                    <p>If you discover a security vulnerability:</p>
                    <ol>
                        <li>Do not publicly disclose the issue</li>
                        <li>Contact our security team at security@squidai.app</li>
                        <li>Provide detailed steps to reproduce the issue</li>
                    </ol>
                    
                    <p>We appreciate responsible disclosure and will respond promptly to all valid reports.</p>
                    
                    <button class="back-button" id="backFromSecurity">
                        <i class="fas fa-arrow-left"></i> Back to Settings
                    </button>
                </div>
            </div>
            
            <!-- IQ Game Container -->
            <div class="game-container" id="gameContainer">
                <div class="game-title">🧠 Emoji IQ Finder</div>
                <div class="round-title" id="roundTitle">Tap the correct emoji!</div>
                <div class="timer-display" id="timerDisplay">⏱️ Time: 5</div>
                <div class="emoji-container" id="emojiContainer"></div>
                <button class="game-button" id="startGameButton">Start Game</button>
                <div class="iq-result" id="iqResult"></div>
                <button class="game-button" id="restartGameButton" style="display: none;">Play Again</button>
            </div>
        </div>

        <div class="bottom-nav">
            <div class="nav-item active" id="homeNav">
                <div class="nav-icon"><i class="fas fa-home"></i></div>
                <div class="nav-label">Home</div>
            </div>
            <div class="nav-item" id="newChatNav">
                <div class="nav-icon"><i class="fas fa-plus-circle"></i></div>
                <div class="nav-label">New Chat</div>
            </div>
        </div>
    </div>

<script>
    // =================================================================================
    // IMPORTANT: Configuration
    // =================================================================================
    const COHERE_API_KEY = "bpSstiCTmvYvzPE396HFKbZABWTA8JfBpkHWMujA";
    const COHERE_API_ENDPOINT = "https://api.cohere.ai/v1/chat";
    
    const GEMINI_API_KEY = "AIzaSyBmzGutz28iMiRQSB8bZ78_HrlQpEb1qQs"; 
    const GEMINI_MODEL = "gemini-1.5-flash-latest";
    const GEMINI_API_ENDPOINT = `https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL}:generateContent?key=${GEMINI_API_KEY}`;
    
    // UPDATED FIREBASE CONFIG
    const firebaseConfig = {
      apiKey: "AIzaSyCnS5bEqwCJHSwUkDbA3gWBRvL3o5OIrrw",
      authDomain: "chat-app-b07dc.firebaseapp.com",
      databaseURL: "https://chat-app-b07dc-default-rtdb.firebaseio.com",
      projectId: "chat-app-b07dc",
      storageBucket: "chat-app-b07dc.firebasestorage.app",
      messagingSenderId: "366248300706",
      appId: "1:366248300706:web:ca64e809e4f0ca52e747fb",
      measurementId: "G-4JZ3MQ9J7M"
    };

    // Initialize Firebase
    const firebaseApp = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth(firebaseApp);

    // =================================================================================
    // DOM Element References
    // =================================================================================
    const loaderContainer = document.getElementById('loaderContainer');
    const loginContainer = document.getElementById('loginContainer');
    const appContainer = document.getElementById('appContainer');
    const emailInput = document.getElementById('emailInput');
    const passwordInput = document.getElementById('passwordInput');
    const authButton = document.getElementById('authButton');
    const toggleAuthModeLink = document.getElementById('toggleAuthModeLink');
    const formFooterText = document.getElementById('formFooterText');
    const emailError = document.getElementById('emailError');
    const passwordError = document.getElementById('passwordError');
    const generalError = document.getElementById('generalError');
    const settingsButton = document.getElementById('settingsButton');
    const logoutButton = document.getElementById('logoutButton');
    const mainContent = document.getElementById('mainContent');
    const chatContainer = document.getElementById('chatContainer');
    const settingsContainer = document.getElementById('settingsContainer');
    const gameContainer = document.getElementById('gameContainer');
    const chatMessages = document.getElementById('chatMessages');
    const chatInput = document.getElementById('chatInput');
    const sendButton = document.getElementById('sendButton');
    const chatButton = document.getElementById('chatButton');
    const iqButton = document.getElementById('iqButton');
    const learnButton = document.getElementById('learnButton');
    const codeButton = document.getElementById('codeButton');
    const homeNav = document.getElementById('homeNav');
    const newChatNav = document.getElementById('newChatNav');
    const themeToggle = document.getElementById('themeToggle');
    const chatHistoryList = document.getElementById('chatHistoryList');
    const noHistoryMessage = document.getElementById('noHistoryMessage');
    const appTitle = document.getElementById('appTitle');

    // Hindi Chat elements
    const hindiChatButton = document.getElementById('hindiChatButton');
    const hindiChatContainer = document.getElementById('hindiChatContainer');
    const hindiChatMessages = document.getElementById('hindiChatMessages');
    const hindiChatInput = document.getElementById('hindiChatInput');
    const hindiSendButton = document.getElementById('hindiSendButton');
    const hindiAttachmentButton = document.getElementById('hindiAttachmentButton');
    const hindiFileInput = document.getElementById('hindiFileInput');
    const hindiImagePreviewContainer = document.getElementById('hindiImagePreviewContainer');
    
    // IQ Game
    const roundTitle = document.getElementById('roundTitle');
    const timerDisplay = document.getElementById('timerDisplay');
    const emojiContainer = document.getElementById('emojiContainer');
    const startGameButton = document.getElementById('startGameButton');
    const restartGameButton = document.getElementById('restartGameButton');
    const iqResult = document.getElementById('iqResult');
    
    // New Settings Pages
    const howToUseBtn = document.getElementById('howToUseBtn');
    const privacyPolicyBtn = document.getElementById('privacyPolicyBtn');
    const securityBtn = document.getElementById('securityBtn');
    const howToUseContainer = document.getElementById('howToUseContainer');
    const privacyPolicyContainer = document.getElementById('privacyPolicyContainer');
    const securityContainer = document.getElementById('securityContainer');
    const backFromHowToUse = document.getElementById('backFromHowToUse');
    const backFromPrivacyPolicy = document.getElementById('backFromPrivacyPolicy');
    const backFromSecurity = document.getElementById('backFromSecurity');
    
    // =================================================================================
    // App State
    // =================================================================================
    let currentUser = null;
    let isTyping = false;
    let isSignupMode = false;
    let currentChat = [];
    let currentHindiChat = [];
    let activeChatType = 'english';
    let selectedHindiFile = null;

    // IQ Game State
    const rounds = [
        { correct: "😀", options: ["😀", "😠", "😎", "😢"] },
        { correct: "🐶", options: ["🐱", "🐶", "🐭", "🐰"] },
        { correct: "🍎", options: ["🍎", "🍌", "🍇", "🍉"] },
        { correct: "🚗", options: ["🚌", "🚗", "🚕", "🚓"] },
        { correct: "🌞", options: ["🌞", "🌜", "⭐", "☁️"] },
        { correct: "❤️", options: ["💙", "💛", "💜", "❤️"] },
        { correct: "🙁", options: ["😕", "🙁", "😒", "😏"] },
        { correct: "😟", options: ["😟", "😑", "😐", "😮"] },
        { correct: "😕", options: ["😏", "😕", "😒", "🙁"] },
        { correct: "😒", options: ["😒", "😐", "😏", "🙃"] }
    ];

    const easyTime = 5;
    const hardTime = 3;

    let currentRound = 0;
    let gameScore = 0;
    let gameTimer;
    let timeLeft;

    // =================================================================================
    // Main App Logic & Authentication
    // =================================================================================

    auth.onAuthStateChanged(user => {
        loaderContainer.style.display = 'none';
        if (user) {
            currentUser = user;
            showApp();
        } else {
            currentUser = null;
            showLogin();
        }
    });
    
    function setupEventListeners() {
        authButton.addEventListener('click', handleAuthAction);
        toggleAuthModeLink.addEventListener('click', (e) => {
            e.preventDefault();
            toggleAuthMode();
        });
        logoutButton.addEventListener('click', handleLogout);
        settingsButton.addEventListener('click', () => navigateTo('settings'));
        
        // English Chat Listeners
        chatInput.addEventListener('keypress', e => { if (e.key === 'Enter' && !isTyping) sendMessage(); });
        sendButton.addEventListener('click', () => { if (!isTyping) sendMessage(); });

        // Preset Listeners
        chatButton.addEventListener('click', () => startChat());
        iqButton.addEventListener('click', () => navigateTo('game'));
        learnButton.addEventListener('click', () => startPresetChat("learn"));
        codeButton.addEventListener('click', () => startPresetChat("code"));
        
        // Hindi Chat & File Upload Listeners
        hindiChatButton.addEventListener('click', () => startHindiChat());
        hindiChatInput.addEventListener('keypress', e => { if (e.key === 'Enter' && !isTyping) sendHindiMessage(); });
        hindiSendButton.addEventListener('click', () => { if (!isTyping) sendHindiMessage(); });
        hindiAttachmentButton.addEventListener('click', () => hindiFileInput.click());
        hindiFileInput.addEventListener('change', handleHindiFileSelect);

        // Navigation
        homeNav.addEventListener('click', () => navigateTo('home'));
        newChatNav.addEventListener('click', () => startChat());
        
        // Theme
        themeToggle.addEventListener('change', toggleTheme);
        
        // IQ Game Listeners
        startGameButton.addEventListener('click', startGame);
        restartGameButton.addEventListener('click', startGame);
        
        // New Settings Page Listeners
        howToUseBtn.addEventListener('click', () => showInfoPage('howToUse'));
        privacyPolicyBtn.addEventListener('click', () => showInfoPage('privacyPolicy'));
        securityBtn.addEventListener('click', () => showInfoPage('security'));
        backFromHowToUse.addEventListener('click', () => navigateTo('settings'));
        backFromPrivacyPolicy.addEventListener('click', () => navigateTo('settings'));
        backFromSecurity.addEventListener('click', () => navigateTo('settings'));
    }
    
    function showLogin() {
        loginContainer.style.display = 'block';
        appContainer.style.display = 'none';
        document.body.style.overflow = 'auto';
        emailInput.value = '';
        passwordInput.value = '';
        clearErrors();
    }

    function showApp() {
        loginContainer.style.display = 'none';
        appContainer.style.display = 'flex';
        document.body.style.overflow = 'hidden';
        navigateTo('home');
        loadTheme();
    }

    function clearErrors() {
        emailError.style.display = 'none';
        passwordError.style.display = 'none';
        generalError.style.display = 'none';
        generalError.textContent = '';
    }

    async function handleAuthAction() {
        if (!validateInputs()) return;
        const email = emailInput.value;
        const password = passwordInput.value;

        authButton.disabled = true;
        authButton.textContent = 'Processing...';
        
        try {
            if (isSignupMode) {
                // Create new user
                await auth.createUserWithEmailAndPassword(email, password);
            } else {
                // Sign in existing user
                await auth.signInWithEmailAndPassword(email, password);
            }
        } catch (error) {
            console.error("Authentication error:", error);
            generalError.textContent = error.message;
            generalError.style.display = 'block';
        } finally {
            authButton.disabled = false;
            authButton.textContent = isSignupMode ? 'Sign Up' : 'Log In';
        }
    }

    function toggleAuthMode() {
        isSignupMode = !isSignupMode;
        clearErrors();
        if (isSignupMode) {
            authButton.textContent = 'Sign Up';
            formFooterText.textContent = 'Already have an account?';
            toggleAuthModeLink.textContent = 'Log In';
        } else {
            authButton.textContent = 'Log In';
            formFooterText.textContent = "Don't have an account?";
            toggleAuthModeLink.textContent = 'Sign Up';
        }
    }
    
    function handleLogout() {
        saveActiveChat();
        auth.signOut();
    }

    function validateInputs() {
        clearErrors();
        let isValid = true;
        if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailInput.value)) {
            emailError.style.display = 'block';
            isValid = false;
        }
        if (passwordInput.value.length < 6) {
            passwordError.style.display = 'block';
            isValid = false;
        }
        return isValid;
    }

    // =================================================================================
    // Navigation Logic
    // =================================================================================

    function navigateTo(section) {
        // Save chat when navigating away
        if (chatContainer.style.display === 'flex' || hindiChatContainer.style.display === 'flex') {
            if (section !== 'chat' && section !== 'hindiChat') {
                saveActiveChat();
            }
        }
        
        // Hide all views
        mainContent.style.display = 'none';
        chatContainer.style.display = 'none';
        hindiChatContainer.style.display = 'none';
        settingsContainer.style.display = 'none';
        gameContainer.style.display = 'none';
        howToUseContainer.style.display = 'none';
        privacyPolicyContainer.style.display = 'none';
        securityContainer.style.display = 'none';
        
        // Update nav item active state
        homeNav.classList.remove('active');
        newChatNav.classList.remove('active');

        // Show the selected view
        if (section === 'home') {
            appTitle.textContent = "Squid AI";
            mainContent.style.display = 'flex';
            homeNav.classList.add('active');
        } else if (section === 'chat') {
            appTitle.textContent = "Squid AI";
            chatContainer.style.display = 'flex';
            newChatNav.classList.add('active');
            activeChatType = 'english';
        } else if (section === 'hindiChat') {
            appTitle.textContent = "Squid AI";
            hindiChatContainer.style.display = 'flex';
            newChatNav.classList.add('active');
            activeChatType = 'hindi';
        } else if (section === 'settings') {
            appTitle.textContent = "Squid AI";
            settingsContainer.style.display = 'flex';
            homeNav.classList.add('active');
            renderChatHistory();
        } else if (section === 'game') {
            appTitle.textContent = "IQ Calculator";
            gameContainer.style.display = 'flex';
            homeNav.classList.add('active');
            resetGame();
        }
    }
    
    function showInfoPage(page) {
        // Hide all pages
        settingsContainer.style.display = 'none';
        howToUseContainer.style.display = 'none';
        privacyPolicyContainer.style.display = 'none';
        securityContainer.style.display = 'none';
        
        // Show the requested page
        if (page === 'howToUse') {
            howToUseContainer.style.display = 'flex';
            appTitle.textContent = "How to Use";
        } else if (page === 'privacyPolicy') {
            privacyPolicyContainer.style.display = 'flex';
            appTitle.textContent = "Privacy Policy";
        } else if (page === 'security') {
            securityContainer.style.display = 'flex';
            appTitle.textContent = "Security";
        }
    }

    // =================================================================================
    // English Chat Functions
    // =================================================================================
    function startChat() {
        navigateTo('chat');
        chatMessages.innerHTML = '';
        currentChat = [];
        addMessage("Hello! I'm Squid AI. How can I help you today?", 'ai');
    }

    function startPresetChat(type) {
        navigateTo('chat');
        chatMessages.innerHTML = '';
        currentChat = [];
        let prompt, aiGreeting;

        if (type === "learn") {
            prompt = "Tell me a fun fact about Artificial Intelligence.";
            aiGreeting = "Of course! Let's learn about AI. Here's a fun fact to start:";
        } else if (type === "code") {
            prompt = "Write a simple Python function to reverse a string.";
            aiGreeting = "Sure, I can help with that. Here is a Python function to get you started:";
        }

        addMessage(aiGreeting, 'ai');
        setTimeout(() => getAIResponse(prompt), 500);
    }
    
    async function sendMessage() {
        const messageText = chatInput.value.trim();
        if (!messageText || isTyping) return;

        addMessage(messageText, 'user');
        chatInput.value = '';
        await getAIResponse(messageText);
    }

    async function getAIResponse(prompt) {
        isTyping = true;
        simulateTyping();
        
        try {
            const chatHistory = currentChat.map(msg => ({
                role: msg.sender === 'user' ? "USER" : "CHATBOT",
                message: msg.text
            }));
            chatHistory.pop();

            const response = await fetch(COHERE_API_ENDPOINT, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${COHERE_API_KEY}` },
                body: JSON.stringify({ message: prompt, chat_history: chatHistory, model: "command-r-plus", temperature: 0.7 })
            });
            
            removeTypingIndicator();
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.message || `API Error: ${response.statusText}`);
            }
            const data = await response.json();
            
            if (data.text) addMessage(data.text, 'ai');
            else addMessage("I'm having trouble understanding. Could you please rephrase?", 'ai');

        } catch (error) {
            console.error('Cohere API Error:', error);
            removeTypingIndicator();
            addMessage("Sorry, I encountered an error: " + error.message, 'ai');
        } finally {
            isTyping = false;
        }
    }

    function addMessage(text, sender) {
        currentChat.push({ text, sender });
        const messageElement = document.createElement('div');
        messageElement.classList.add('message', `${sender}-message`);
        const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        
        const textNode = document.createElement('div');
        textNode.innerText = text;

        messageElement.innerHTML = `<div>${textNode.innerHTML.replace(/\n/g, '<br>')}</div><div class="message-time">${time}</div>`;
        chatMessages.appendChild(messageElement);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function simulateTyping() {
        const typingElement = document.createElement('div');
        typingElement.classList.add('typing-indicator');
        typingElement.innerHTML = `<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>`;
        chatMessages.appendChild(typingElement);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function removeTypingIndicator() {
        const typingIndicator = chatMessages.querySelector('.typing-indicator');
        if (typingIndicator) typingIndicator.remove();
    }
    
    // =================================================================================
    // Hindi Chat Functions
    // =================================================================================
    function startHindiChat() {
        navigateTo('hindiChat');
        hindiChatMessages.innerHTML = '';
        currentHindiChat = [];
        clearHindiPreview();
        addHindiMessage("नमस्ते! मैं स्क्विड एआई हूँ। आप कोई तस्वीर भेज सकते हैं या मुझसे कुछ पूछ सकते हैं।", 'ai');
    }

    async function sendHindiMessage() {
        const messageText = hindiChatInput.value.trim();
        const fileToSend = selectedHindiFile;

        if ((!messageText && !fileToSend) || isTyping) return;

        addHindiMessage(messageText, 'user', fileToSend ? fileToSend.base64 : null);
        hindiChatInput.value = '';
        clearHindiPreview();
        
        await getGeminiResponse(messageText, fileToSend);
    }
    
    function handleHindiFileSelect(event) {
        const file = event.target.files[0];
        if (!file) return;

        // Validate file type
        const validImageTypes = ['image/jpeg', 'image/png', 'image/webp'];
        if (!validImageTypes.includes(file.type)) {
            alert('Please select a valid image file (JPEG, PNG, or WEBP).');
            return;
        }

        const reader = new FileReader();
        reader.onload = function(e) {
            selectedHindiFile = {
                base64: e.target.result,
                mimeType: file.type
            };
            displayHindiImagePreview(e.target.result);
        };
        reader.readAsDataURL(file);
    }
    
    function displayHindiImagePreview(imageDataUrl) {
        hindiImagePreviewContainer.innerHTML = `
            <div class="image-preview">
                <button class="remove-preview-btn" title="Remove image">×</button>
                <img src="${imageDataUrl}" alt="Image preview">
            </div>
        `;
        hindiImagePreviewContainer.querySelector('.remove-preview-btn').addEventListener('click', clearHindiPreview);
    }

    function clearHindiPreview() {
        selectedHindiFile = null;
        hindiFileInput.value = '';
        hindiImagePreviewContainer.innerHTML = '';
    }

    async function getGeminiResponse(prompt, file) {
        if (!checkAndIncrementHindiUsage()) {
            addHindiMessage("आज के लिए आपकी फ्री लिमिट समाप्त हो गई है। कृपया कल फिर प्रयास करें।\n(Your free daily limit has been reached. Please try again tomorrow.)", 'ai');
            return;
        }

        isTyping = true;
        simulateHindiTyping();
        
        try {
            // Construct the parts for the multimodal request
            const parts = [];
            if (prompt) {
                parts.push({ text: prompt });
            }
            if (file) {
                parts.push({
                    inline_data: {
                        mime_type: file.mimeType,
                        data: file.base64.split(',')[1] // Remove the Data URL prefix
                    }
                });
            }

            const response = await fetch(GEMINI_API_ENDPOINT, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts: parts }]
                })
            });
            
            removeHindiTypingIndicator();
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error.message || `API Error: ${response.status}`);
            }
            const data = await response.json();
            
            const aiReply = data?.candidates?.[0]?.content?.parts?.[0]?.text || "माफ़ कीजिये, मुझे कोई प्रतिक्रिया नहीं मिली।";
            addHindiMessage(aiReply, 'ai');

        } catch (error) {
            console.error('Gemini API Error:', error);
            removeHindiTypingIndicator();
            addHindiMessage("माफ़ कीजिये, एक त्रुटि हुई: " + error.message, 'ai');
        } finally {
            isTyping = false;
        }
    }

    function addHindiMessage(text, sender, imageUrl = null) {
        currentHindiChat.push({ text, sender, imageUrl });
        const messageElement = document.createElement('div');
        messageElement.classList.add('message', `${sender}-message`);
        const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        
        let messageContent = '';

        if (imageUrl) {
            messageContent += `<img src="${imageUrl}" class="message-image" alt="User upload">`;
        }

        if (text) {
            const textNode = document.createElement('div');
            textNode.innerText = text;
            messageContent += `<div>${textNode.innerHTML.replace(/\n/g, '<br>')}</div>`;
        }
        
        messageElement.innerHTML = `${messageContent}<div class="message-time">${time}</div>`;
        hindiChatMessages.appendChild(messageElement);
        hindiChatMessages.scrollTop = hindiChatMessages.scrollHeight;
    }

    function simulateHindiTyping() {
        const typingElement = document.createElement('div');
        typingElement.classList.add('typing-indicator');
        typingElement.innerHTML = `<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>`;
        hindiChatMessages.appendChild(typingElement);
        hindiChatMessages.scrollTop = hindiChatMessages.scrollHeight;
    }

    function removeHindiTypingIndicator() {
        const typingIndicator = hindiChatMessages.querySelector('.typing-indicator');
        if (typingIndicator) typingIndicator.remove();
    }

    function checkAndIncrementHindiUsage() {
        if (!currentUser) return false;
        const limit = 100;
        const usageKey = `hindiUsage_${currentUser.uid}`;
        const todayStr = new Date().toISOString().split('T')[0];
        
        const usageData = JSON.parse(localStorage.getItem(usageKey) || '{}');
        const todaysCount = usageData[todayStr] || 0;

        if (todaysCount >= limit) {
            console.warn(`Hindi chat daily limit of ${limit} reached for user.`);
            return false;
        }

        usageData[todayStr] = todaysCount + 1;
        localStorage.setItem(usageKey, JSON.stringify(usageData));
        return true;
    }

    // =================================================================================
    // IQ Game Functions
    // =================================================================================
    function resetGame() {
        currentRound = 0;
        gameScore = 0;
        startGameButton.style.display = 'block';
        restartGameButton.style.display = 'none';
        iqResult.textContent = '';
        roundTitle.textContent = 'Tap the correct emoji!';
        timerDisplay.textContent = '⏱️ Time: 5';
        emojiContainer.innerHTML = '';
    }

    function startGame() {
        currentRound = 0;
        gameScore = 0;
        startGameButton.style.display = 'none';
        restartGameButton.style.display = 'none';
        iqResult.textContent = '';
        nextRound();
    }

    function nextRound() {
        if (currentRound >= rounds.length) {
            endGame();
            return;
        }

        const round = rounds[currentRound];
        roundTitle.textContent = `Round ${currentRound + 1}: Tap ${round.correct}`;
        emojiContainer.innerHTML = '';
        round.options.sort(() => Math.random() - 0.5);
        round.options.forEach(emoji => {
            const span = document.createElement("span");
            span.textContent = emoji;
            span.className = "emoji";
            span.onclick = () => handleAnswer(emoji);
            emojiContainer.appendChild(span);
        });

        // Set time per round
        timeLeft = currentRound >= 6 ? hardTime : easyTime;
        updateTimer();
        gameTimer = setInterval(() => {
            timeLeft--;
            updateTimer();
            if (timeLeft <= 0) {
                clearInterval(gameTimer);
                currentRound++;
                nextRound();
            }
        }, 1000);
    }

    function updateTimer() {
        timerDisplay.textContent = `⏱️ Time: ${timeLeft}`;
    }

    function handleAnswer(emoji) {
        const round = rounds[currentRound];
        if (emoji === round.correct) gameScore++;
        clearInterval(gameTimer);
        currentRound++;
        nextRound();
    }

    function endGame() {
        emojiContainer.innerHTML = '';
        roundTitle.textContent = "Game Over!";
        timerDisplay.textContent = "";

        let iq;
        if (gameScore <= 3) iq = randomBetween(100, 110);
        else if (gameScore <= 6) iq = randomBetween(111, 125);
        else if (gameScore <= 8) iq = randomBetween(126, 139);
        else iq = randomBetween(140, 150);

        iqResult.textContent = `🧠 Your IQ is: ${iq}`;
        restartGameButton.style.display = 'block';
    }

    function randomBetween(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    // =================================================================================
    // Theme Persistence
    // =================================================================================
    function toggleTheme() {
        document.body.classList.toggle('light-mode');
        const theme = document.body.classList.contains('light-mode') ? 'light' : 'dark';
        localStorage.setItem('theme', theme);
    }

    function loadTheme() {
        const theme = localStorage.getItem('theme');
        if (theme === 'light') {
            document.body.classList.add('light-mode');
            themeToggle.checked = true;
        } else {
            document.body.classList.remove('light-mode');
            themeToggle.checked = false;
        }
    }
    
    // =================================================================================
    // Chat History Logic
    // =================================================================================
    function getHistory() {
        if (!currentUser) return [];
        const history = localStorage.getItem(`chatHistory_${currentUser.uid}`);
        return history ? JSON.parse(history) : [];
    }
    
    function saveHistory(history) {
        if (!currentUser) return;
        localStorage.setItem(`chatHistory_${currentUser.uid}`, JSON.stringify(history));
    }

    function saveActiveChat() {
        const chatToSave = activeChatType === 'hindi' ? currentHindiChat : currentChat;
        if (chatToSave.length > 1) { // Only save non-empty chats
            const history = getHistory();
            const userMessages = chatToSave.filter(m => m.sender === 'user');
            
            // Generate a title
            let title = "Chat"; // Default title
            if (userMessages.length > 0) {
                 title = userMessages[0].text || (userMessages[0].imageUrl ? "Image Chat" : "Chat");
            } else {
                 title = (activeChatType === 'hindi' ? "हिंदी चैट" : "Chat");
            }
            
            history.unshift({
                id: Date.now(),
                title: title.substring(0, 40) + (title.length > 40 ? '...' : ''),
                messages: chatToSave,
                lang: activeChatType === 'hindi' ? 'hi' : 'en'
            });
            
            saveHistory(history.slice(0, 20));

            // Reset the saved chat
            if(activeChatType === 'hindi') {
                currentHindiChat = [];
                clearHindiPreview();
            }
            else currentChat = [];
        }
    }

    function renderChatHistory() {
        chatHistoryList.innerHTML = '';
        const history = getHistory();
        noHistoryMessage.style.display = history.length === 0 ? 'block' : 'none';

        history.forEach(chat => {
            const li = document.createElement('li');
            li.className = 'history-item';
            const langBadge = chat.lang === 'hi' ? '<span class="lang-badge">हि</span>' : '';

            li.innerHTML = `
                <div style="display: flex; align-items: center; overflow: hidden;">
                    ${langBadge}
                    <span class="history-title">${chat.title}</span>
                </div>
                <div class="history-actions">
                    <button class="view-btn" title="View"><i class="fas fa-eye"></i></button>
                    <button class="delete-btn" title="Delete"><i class="fas fa-trash"></i></button>
                </div>
            `;
            li.querySelector('.view-btn').addEventListener('click', () => loadChatFromHistory(chat.id));
            li.querySelector('.delete-btn').addEventListener('click', (e) => {
                e.stopPropagation();
                deleteChatFromHistory(chat.id);
            });
            chatHistoryList.appendChild(li);
        });
    }

    function loadChatFromHistory(chatId) {
        const history = getHistory();
        const chat = history.find(c => c.id === chatId);
        if (chat) {
            if (chat.lang === 'hi') {
                navigateTo('hindiChat');
                hindiChatMessages.innerHTML = '';
                currentHindiChat = [];
                clearHindiPreview();
                chat.messages.forEach(msg => addHindiMessage(msg.text, msg.sender, msg.imageUrl));
            } else {
                navigateTo('chat');
                chatMessages.innerHTML = '';
                currentChat = [];
                chat.messages.forEach(msg => addMessage(msg.text, msg.sender));
            }
        }
    }
    
    function deleteChatFromHistory(chatId) {
        let history = getHistory();
        history = history.filter(c => c.id !== chatId);
        saveHistory(history);
        renderChatHistory();
    }

    // =================================================================================
    // Start the App
    // =================================================================================
    setupEventListeners();

</script>
</body>
</html>